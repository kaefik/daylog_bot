# TODO

## Журнал

### 2025-09-20
- [fix] Добавлена локализация для сообщения "Теперь вы можете начать вести дневник!"
  - Добавлен ключ локализации "start_ready" на всех поддерживаемых языках
  - Обновлены обработчики выбора часового пояса для использования локализованного сообщения
- [update] Добавлены локализации для часовых поясов на всех поддерживаемых языках
  - Добавлены переводы для башкирского языка (ba.json)
  - Добавлены переводы для башкирского латиницей (ba_lat.json)
  - Добавлены переводы для татарского языка (tt.json)
  - Добавлены переводы для татарского латиницей (tt_lat.json)
- [update] Добавлена кнопка "Отмена" в диалог выбора часового пояса
  - Для зарегистрированных пользователей при отмене текущий часовой пояс остается без изменений
  - Для новых пользователей при отмене устанавливается часовой пояс Москвы по умолчанию
  - Добавлены соответствующие локализации для текстов и кнопок
- [update] Улучшен выбор часового пояса в команде `/start`
  - Теперь выбор часового пояса предлагается всем пользователям, включая уже зарегистрированных
  - Упрощен интерфейс: одинаковый поток для новых и существующих пользователей
- [feat] Добавлена настройка часового пояса в команде `/start` для новых пользователей
  - Реализован выбор часового пояса из списка популярных зон для России и соседних стран
  - Добавлены методы `get_user_settings` и `update_user_settings` в `DatabaseManager` для работы с настройками
  - Добавлена зависимость `pytz` для работы с часовыми поясами
  - Добавлены inline-кнопки для выбора часового пояса
  - Добавлены соответствующие переводы для интерфейса
- [fix] Исправлена проблема с кнопкой "Отмена" в команде `/export`
  - Заменен ключ локализации 'cancel' на 'btn_cancel' в плагине export.py
  - Теперь кнопка отмены корректно отображается на всех языках
- [feat] Добавлена команда `/export` для экспорта записей в формате Markdown
  - Создан модуль `core/export/manager.py` для экспорта записей дневника в различные форматы
  - Реализован плагин для команды `/export` с возможностью выбора периода экспорта
  - Добавлены inline-кнопки для выбора периода: сегодня, неделя, месяц, весь дневник, произвольный диапазон дат
  - Реализована генерация Markdown-файла и отправка его пользователю
  - Добавлены соответствующие переводы для интерфейса команды
- [refactor] Вынос логики работы с дневником в отдельный модуль core/diary
  - Создан класс DiaryManager в core/diary/manager.py для централизованного управления дневниковыми записями
  - Реализованы методы для создания, редактирования и отображения записей
  - Добавлена поддержка интернационализации (i18n)
  - Созданы версии плагинов today и yesterday, использующие новый DiaryManager
  - Сохранена полная функциональность плагинов при переходе на новую архитектуру
- [fix] Исправлена проблема с кнопкой "Редактировать" в команде `/today`
  - При вызове метода `check_existing_entry` добавлена передача параметра `prefix="today"` 
  - Теперь данные кнопок формируются корректно: "edit_today", "edit_today_events", "cancel_edit_today"
  - Обработчик корректно реагирует на нажатие кнопок

### 2025-09-19
- [feat] Добавлена кнопка "Отмена" на всех этапах мастера создания записи в команде `/yesterday`
  - Добавлена кнопка "Отмена" во все клавиатуры мастера (настроение, погода, местоположение, события)
  - Добавлен обработчик отмены создания записи через кнопку
  - Добавлена возможность отмены через текстовую команду "отмена" при ручном вводе
  - Добавлены соответствующие подсказки в текстовые сообщения для ручного ввода
- [feat] Добавлена кнопка "Отмена" на всех этапах мастера создания записи в команде `/today`
  - Добавлена кнопка "Отмена" во все клавиатуры мастера (настроение, погода, местоположение, события)
  - Добавлен обработчик отмены создания записи через кнопку
  - Добавлена возможность отмены через текстовую команду "отмена" при ручном вводе
  - Добавлены соответствующие подсказки в текстовые сообщения для ручного ввода
- [fix] Исправлена ошибка преобразования типов даты в команде `/view`
  - Добавлена проверка типа `entry_date` в функциях `display_period_entries` и `display_multiple_entries`
  - Исправлена обработка даты при получении записей за период
- [feat] Изменено поведение команды `/view` без параметров
  - Добавлено меню выбора периода (сегодня, неделя, месяц, другая дата)
  - Реализован просмотр записей за текущую неделю и текущий месяц
  - Добавлены соответствующие обработчики для inline-кнопок
  - Обновлена справка по команде
- [feat] Добавлена возможность просмотра записей за все годы в команде `/view`
  - Добавлен параметр ДД.ММ.* для просмотра записей за указанную дату всех лет
  - Реализован метод `get_diary_entries_by_day_month` в `DatabaseManager`
  - Добавлено форматирование и отображение записей для нескольких лет
  - Обновлена справка по команде
- [fix] Исправление ошибок в тестах базы данных
  - Исправлен импорт в `tests/test_database.py`
  - Исправлены отступы в `core/database/manager.py`
  - Исправлена логика обновления записей
  - Добавлены адаптеры для SQLite для совместимости с Python 3.12+
  - Добавлен метод `get_entries_by_period`

### 2025-08-15
- [feat] Добавлена документация структуры проекта в `docs/project_structure.md`
  - Добавлено дерево папок проекта
  - Подробное описание архитектуры и компонентов
  - Инструкции по расширению функциональности

### 2025-07-20
- [feat] Добавлены плагины управления дневником
  - Реализована команда `/today` для записей текущего дня
  - Реализована команда `/yesterday` для записей вчерашнего дня
  - Добавлена возможность редактирования настроения, погоды, местоположения и событий

### 2025-06-10
- [feat] Реализована система интернационализации (i18n)
  - Добавлены локализации: русский, английский, татарский, башкирский
  - Добавлена команда `/setlang` для смены языка интерфейса

### 2025-05-05
- [feat] Созданы модели данных с использованием Pydantic
  - Определены модели `User`, `DiaryEntry`
  - Созданы перечисления для типов настроения, погоды, форматов и др.

### 2025-04-15
- [feat] Разработан модуль работы с базой данных
  - Создан класс `DatabaseManager` для операций CRUD
  - Реализованы методы для работы с записями дневника
  - Добавлена система миграций и инициализации БД

### 2025-03-01
- [feat] Реализована плагинная система
  - Создан базовый фреймворк `tlgbotcore` с поддержкой плагинов
  - Добавлена динамическая загрузка плагинов из директории
  - Реализован механизм внедрения зависимостей

### 2025-02-10
- [feat] Настроен проект
  - Созданы базовые структуры каталогов
  - Настроен менеджер зависимостей и инструменты разработки
  - Добавлены линтеры и тесты

## Выполненные задачи ✅

### Разработка ядра
- ✅ Создание и настройка базового фреймворка tlgbotcore
- ✅ Реализация плагинной системы
- ✅ Создание контейнера внедрения зависимостей (DI)
- ✅ Добавление системы интернационализации (i18n)

### Управление данными
- ✅ Разработка моделей данных с использованием Pydantic
- ✅ Создание и настройка базы данных SQLite
- ✅ Реализация методов CRUD для работы с дневником
- ✅ Добавление метода получения записей за период

### Плагины и команды
- ✅ Команда `/start` для регистрации пользователя
- ✅ Команда `/today` для работы с записью текущего дня
- ✅ Команда `/yesterday` для работы с записью предыдущего дня
- ✅ Команда `/setlang` для смены языка интерфейса
- ✅ Система аутентификации пользователей

### Тестирование
- ✅ Написаны тесты для базы данных
- ✅ Созданы тесты для моделей данных
- ✅ Добавлены тесты производительности
- ✅ Исправлены ошибки совместимости с Python 3.12+

### Инфраструктура
- ✅ Настройка структуры проекта
- ✅ Настройка линтеров (ruff)
- ✅ Добавление проверок типов (mypy)
- ✅ Создание документации

## Невыполненные задачи ⏳

### Улучшение плагинной системы
- [ ] Создать базовый класс для плагинов с общими методами
- [ ] Добавить автоматическую регистрацию плагинов через декораторы
- [ ] Внедрить проверку зависимостей между плагинами

### Расширение функциональности бота
- [ ] Добавить экспорт дневника в PDF формат
- [ ] Реализовать напоминания о пропущенных днях
- [ ] Добавить поиск по записям дневника
- [ ] Внедрить анализ настроения по текстам записей

### Улучшение тестирования
- [ ] Написать тесты для плагинов
- [ ] Добавить integration тесты
- [ ] Настроить CI/CD пайплайн

### Документация
- [ ] Обновить README с инструкциями для разработчиков
- [ ] Добавить документацию по API
- [ ] Создать руководство пользователя