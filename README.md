# üìù daylog_bot

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ–≥–æ –¥–Ω–µ–≤–Ω–∏–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö. –ë–æ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.

![license](https://img.shields.io/badge/license-MIT-green)

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞** ‚Äî –∑–∞–ø–∏—Å—å –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫
- **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ, –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ, —Ç–∞—Ç–∞—Ä—Å–∫–æ–≥–æ, –±–∞—à–∫–∏—Ä—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤
- **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** ‚Äî –≤—ã–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–µ–π –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
- **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫
- **–ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π

## ‚öôÔ∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   git clone git@github.com:kaefik/daylog_bot.git
   cd daylog_bot
   uv sync
   # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
   uv sync --extra dev
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥:**
   ```bash
   cp cfg/config_tlg_example.py cfg/config_tlg.py
   # –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è (API_ID, HASH, TOKEN, ADMINS...)
   ```

3. **–ó–∞–ø—É—Å–∫:**
   ```bash
   uv run -m bot.start_tlgbotcore
   ```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø–ª–∞–≥–∏–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram API     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  tlgbotcore  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ    Plugins    ‚îÇ
‚îÇ  (—á–µ—Ä–µ–∑ Telethon) ‚îÇ     ‚îÇ (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫)  ‚îÇ     ‚îÇ  (–∫–æ–º–∞–Ω–¥—ã)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                      ‚îÇ
                                ‚îÇ                      ‚îÇ
                                ‚ñº                      ‚ñº
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ    Core      ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  Database     ‚îÇ
                          ‚îÇ (–±–∏–∑–Ω–µ—Å-     ‚îÇ     ‚îÇ  (SQLite)     ‚îÇ
                          ‚îÇ  –ª–æ–≥–∏–∫–∞)     ‚îÇ     ‚îÇ               ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **tlgbotcore** ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram-–±–æ—Ç–æ–≤ —Å –ø–ª–∞–≥–∏–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **plugins_bot** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –¥–ª—è –∫–æ–º–∞–Ω–¥ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞
- **core** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–∏–∫–∞
- **database** ‚Äî —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ SQLite

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

```bash
uv run ruff check .        # –ª–∏–Ω—Ç–µ—Ä
uv run ruff format .       # –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç
uv run mypy bot/           # —Ç–∏–ø–∏–∑–∞—Ü–∏—è
uv run pytest              # —Ç–µ—Å—Ç—ã
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–æ–≤

–ü–ª–∞–≥–∏–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `bot/plugins_bot/`. –ö–∞–∂–¥—ã–π –ø–ª–∞–≥–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É `tlgbot`:

```python
# –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–ª–∞–≥–∏–Ω–∞ (plugins_bot/today/today.py)
from telethon import events, Button
from bot.require_diary_user import require_diary_user

tlgbot = globals().get('tlgbot')
logger = globals().get('logger')

@tlgbot.on(events.NewMessage(pattern=r'/today'))
@require_diary_user  # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
async def handler(event):
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã
```

### –°–∏—Å—Ç–µ–º–∞ –º–µ–Ω—é

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç inline-–º–µ–Ω—é –¥–ª—è —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏. –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ [docs/menu_system_howto.md](docs/menu_system_howto.md).

–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é:

```python
from bot.menu_system import register_menu

register_menu({
    'key': 'new_feature',         # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á
    'tr_key': 'menu_new_feature', # –ö–ª—é—á –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
    'plugin': 'my_plugin',        # –ò–º—è –ø–ª–∞–≥–∏–Ω–∞
    'handler': 'feature_handler', # –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    'order': 100                  # –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
})
```

### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (i18n)

–ü–µ—Ä–µ–≤–æ–¥—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON —Ñ–∞–π–ª–∞—Ö –≤ `bot/locales/`. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:

```python
message = tlgbot.i18n.t('entry_title', lang=lang, date=date_str)
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –∑–∞–ø–∏—Å–µ–π –¥–Ω–µ–≤–Ω–∏–∫–∞:

```python
from core.database.manager import DatabaseManager
from cfg.config_tlg import DAYLOG_DB_PATH

db = DatabaseManager(db_path=DAYLOG_DB_PATH)
entry = db.get_diary_entry(user_id, entry_date)
```

## üìÅ –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

- `/bot/tlgbotcore/_core.py` ‚Äî —è–¥—Ä–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –¥–ª—è –±–æ—Ç–∞
- `/core/models.py` ‚Äî –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø–∏—Å–µ–π –¥–Ω–µ–≤–Ω–∏–∫–∞
- `/core/database/manager.py` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- `/bot/plugins_bot/` ‚Äî –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã/—Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞ –≤ –≤–∏–¥–µ –ø–ª–∞–≥–∏–Ω–æ–≤
- `/cfg/config_tlg.py` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ –ø—Ä–∏–º–µ—Ä–∞)

## üöÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ `bot/plugins_bot/`
2. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã –ø–ª–∞–≥–∏–Ω–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç `tlgbot` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–≤–æ–¥—ã –≤ JSON —Ñ–∞–π–ª—ã –≤ `bot/locales/`

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

–ü—Ä–∏–º–µ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ —Å –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```python
# bot/plugins_bot/myfeature/myfeature.py
from telethon import events

tlgbot = globals().get('tlgbot')
logger = globals().get('logger')

@tlgbot.on(events.NewMessage(pattern=r'/myfeature'))
async def myfeature_handler(event):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /myfeature"""
    user_id = event.sender_id
    await event.respond("–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!")
    
    # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
    # from core.database.manager import DatabaseManager
    # from cfg.config_tlg import DAYLOG_DB_PATH
    # db = DatabaseManager(db_path=DAYLOG_DB_PATH)
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.